---
phase: 04-pytorch-evaluation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/evaluate_pytorch.py
autonomous: true

must_haves:
  truths:
    - "Running evaluation script produces accuracy output"
    - "Per-class accuracy displayed for all 10 CIFAR-10 classes"
    - "Overall accuracy is >= 85%"
    - "Output shows total correct, total samples, percentage"
  artifacts:
    - path: "scripts/evaluate_pytorch.py"
      provides: "PyTorch model evaluation on CIFAR-10"
      min_lines: 50
      contains: "torch"
  key_links:
    - from: "scripts/evaluate_pytorch.py"
      to: "models/resnet8.pt"
      via: "torch.load"
      pattern: "torch\\.load.*pt"
    - from: "scripts/evaluate_pytorch.py"
      to: "cifar-10-batches-py/test_batch"
      via: "pickle.load"
      pattern: "pickle\\.load.*test_batch"
---

<objective>
Evaluate the PyTorch ResNet8 model on CIFAR-10 test set and verify >85% accuracy

Purpose: Validate the converted PyTorch model produces accurate predictions
Output: Evaluation script that reports overall and per-class accuracy
</objective>

<execution_context>
@/home/impactaky/shelffiles/config/claude/get-shit-done/workflows/execute-plan.md
@/home/impactaky/shelffiles/config/claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@scripts/evaluate.py
@scripts/convert_pytorch.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PyTorch evaluation script</name>
  <files>scripts/evaluate_pytorch.py</files>
  <action>
Create scripts/evaluate_pytorch.py based on scripts/evaluate.py but using PyTorch:

1. Load PyTorch model from models/resnet8.pt using torch.load
2. Set model to eval mode
3. Load CIFAR-10 test_batch from /mnt/ext1/references/tiny/benchmark/training/image_classification/cifar-10-batches-py/
4. Use pickle.load(fo, encoding='bytes') with byte-string keys (b'data', b'labels')
5. Reshape images: (10000, 3072) -> reshape(-1, 3, 32, 32) -> transpose(0, 2, 3, 1) -> (10000, 32, 32, 3)
6. Convert to float32 WITHOUT normalizing (model expects raw pixel values 0-255)
7. Convert numpy array to torch.Tensor
8. Run inference with torch.no_grad() context
9. Calculate overall accuracy
10. Calculate per-class accuracy for all 10 classes
11. Print results with format: class_name: correct/total = percentage
12. Load class names from batches.meta file

Use argparse for configurable paths:
--model (default: models/resnet8.pt)
--data-dir (default: /mnt/ext1/references/tiny/benchmark/training/image_classification/cifar-10-batches-py)

IMPORTANT: Use model.eval() before inference.
IMPORTANT: Use torch.no_grad() context for inference.
IMPORTANT: Do NOT normalize to [0,1] - model expects raw pixel values (0-255).
  </action>
  <verify>
- venv/bin/python scripts/evaluate_pytorch.py --help shows usage
- Script imports torch and uses torch.load
  </verify>
  <done>
- scripts/evaluate_pytorch.py exists
- Script accepts --model and --data-dir arguments
  </done>
</task>

<task type="auto">
  <name>Task 2: Run evaluation and verify accuracy</name>
  <files>None (verification only)</files>
  <action>
Run the evaluation script on the PyTorch model:

venv/bin/python scripts/evaluate_pytorch.py

Expected output format:
- Model loaded from models/resnet8.pt
- Number of test images (10000)
- Overall accuracy: correct/10000 = X.XX%
- Per-class accuracy for all 10 classes

Target: >= 85% overall accuracy (same as ONNX result of 87.19%)
  </action>
  <verify>
- Script output shows "Overall Accuracy: X/10000 = XX.XX%"
- Per-class accuracy shown for all 10 classes
- Overall accuracy >= 85.0%
  </verify>
  <done>
- Evaluation completes successfully
- All 10 per-class accuracies reported
- Overall accuracy >= 85% (PT-05 satisfied)
  </done>
</task>

</tasks>

<verification>
Phase 4 requirements checklist:
- [ ] PT-03: Evaluate PyTorch model on CIFAR-10 test set
- [ ] PT-04: Report per-class accuracy breakdown (10 classes)
- [ ] PT-05: Overall accuracy >= 85% on CIFAR-10 test set

Success criteria from roadmap:
- [ ] Evaluation script runs inference on all 10,000 CIFAR-10 test images using PyTorch
- [ ] Per-class accuracy is reported for all 10 classes
- [ ] Overall accuracy is >=85% on CIFAR-10 test set
- [ ] Evaluation output includes total correct predictions, total samples, and percentage accuracy
</verification>

<success_criteria>
1. scripts/evaluate_pytorch.py exists and runs without errors
2. PyTorch inference completes on 10,000 test images
3. Per-class accuracy printed for all 10 classes
4. Overall accuracy >= 85%
5. Output format: "Overall Accuracy: XXXX/10000 = XX.XX%"
</success_criteria>

<output>
After completion, create `.planning/phases/04-pytorch-evaluation/04-01-SUMMARY.md`
</output>
