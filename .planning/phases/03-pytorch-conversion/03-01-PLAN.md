---
phase: 03-pytorch-conversion
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - requirements.txt
  - scripts/convert_pytorch.py
  - models/resnet8.pt
autonomous: true

must_haves:
  truths:
    - "Running conversion script produces PyTorch model file"
    - "PyTorch model accepts input shape (batch, 32, 32, 3)"
    - "PyTorch model produces output shape (batch, 10)"
    - "Conversion logs show successful onnx2torch execution"
  artifacts:
    - path: "scripts/convert_pytorch.py"
      provides: "ONNX to PyTorch conversion"
      min_lines: 30
      contains: "onnx2torch"
    - path: "models/resnet8.pt"
      provides: "Converted PyTorch model"
    - path: "requirements.txt"
      provides: "onnx2torch dependency"
      contains: "onnx2torch"
  key_links:
    - from: "scripts/convert_pytorch.py"
      to: "models/resnet8.onnx"
      via: "onnx2torch.convert"
      pattern: "convert.*onnx"
    - from: "scripts/convert_pytorch.py"
      to: "models/resnet8.pt"
      via: "torch.save"
      pattern: "torch\\.save"
---

<objective>
Convert ONNX ResNet8 model to PyTorch and verify structure

Purpose: Enable PyTorch-based inference for the converted model
Output: PyTorch model file (.pt) and conversion script
</objective>

<execution_context>
@/home/impactaky/shelffiles/config/claude/get-shit-done/workflows/execute-plan.md
@/home/impactaky/shelffiles/config/claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@scripts/convert.py
@scripts/evaluate.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add onnx2torch and create conversion script</name>
  <files>requirements.txt, scripts/convert_pytorch.py</files>
  <action>
1. Update requirements.txt to add:
   - onnx2torch>=1.5.15
   - torch>=2.0.0
   - torchvision>=0.15.0

2. Install the new dependencies:
   venv/bin/pip install -r requirements.txt

3. Create scripts/convert_pytorch.py:
   - Import onnx2torch convert function
   - Load ONNX model from models/resnet8.onnx
   - Convert to PyTorch using onnx2torch.convert()
   - Set model to eval mode
   - Verify input/output shapes with a test tensor
   - Save PyTorch model state_dict to models/resnet8.pt
   - Log conversion details (input shape, output shape, parameter count)

4. Use argparse for configurable paths:
   --input (default: models/resnet8.onnx)
   --output (default: models/resnet8.pt)

IMPORTANT: Use model.eval() before inference to ensure BatchNorm uses running statistics.
IMPORTANT: Save state_dict along with model for flexibility.
  </action>
  <verify>
- venv/bin/pip show onnx2torch returns version >= 1.5.15
- venv/bin/pip show torch returns version >= 2.0.0
- venv/bin/python scripts/convert_pytorch.py --help shows usage
- venv/bin/python -c "import onnx2torch; print(onnx2torch.__version__)" succeeds
  </verify>
  <done>
- onnx2torch and torch installed in venv
- scripts/convert_pytorch.py exists with onnx2torch usage
- Script accepts --input and --output arguments
  </done>
</task>

<task type="auto">
  <name>Task 2: Run conversion and verify model structure</name>
  <files>models/resnet8.pt</files>
  <action>
Run the conversion script:

venv/bin/python scripts/convert_pytorch.py

Expected output:
- Loading ONNX model from models/resnet8.onnx
- Converting to PyTorch...
- Model converted successfully
- Input shape: (batch, 32, 32, 3)
- Output shape: (batch, 10)
- Parameters: [count]
- Saved to models/resnet8.pt

Verify the saved model:
- Check file exists and has reasonable size
- Load and verify can do forward pass
  </action>
  <verify>
- models/resnet8.pt exists
- Script output shows successful conversion
- Input shape matches ONNX model (batch, 32, 32, 3)
- Output shape matches ONNX model (batch, 10)
  </verify>
  <done>
- Conversion completes successfully
- PyTorch model file saved
- Model structure verified (correct shapes)
  </done>
</task>

</tasks>

<verification>
Phase 3 requirements checklist:
- [ ] PT-01: Convert ONNX model to PyTorch using onnx2torch
- [ ] PT-02: Verify PyTorch model structure matches ONNX source

Success criteria from roadmap:
- [ ] PyTorch model loads successfully from ONNX using onnx2torch
- [ ] Model accepts same input shape (batch, 32, 32, 3) as ONNX
- [ ] Model produces same output shape (batch, 10) as ONNX
- [ ] Conversion script logs successful onnx2torch execution
</verification>

<success_criteria>
1. scripts/convert_pytorch.py exists and runs without errors
2. onnx2torch conversion completes successfully
3. PyTorch model saved to models/resnet8.pt
4. Model input shape: (batch, 32, 32, 3)
5. Model output shape: (batch, 10)
</success_criteria>

<output>
After completion, create `.planning/phases/03-pytorch-conversion/03-01-SUMMARY.md`
</output>
